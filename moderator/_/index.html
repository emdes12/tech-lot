<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control Board</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main>
      <div class="side-bar">
        <a href="#" class="top-logo">
          <img src="./images/table-icon.svg" alt="dashboard" />
        </a>

        <nav>
          <a href="#teams">
            <div class="nav-list">
              <img
                src="./images/users-643ddc64cb0f826743e01e79f4ccf6ae.svg"
                alt="users"
              />
            </div>
            <span class="title">Teams List</span>
          </a>
          <a href="#services">
            <div class="nav-list">
              <img
                src="./images/incandescent-light-bulb-svgrepo-com.svg
              "
                alt="services"
              />
            </div>
            <span class="title">Service List</span>
          </a>
          <a href="#faqs">
            <div class="nav-list">
              <img
                src="./images/question-mark-inside-square-svgrepo-com.svg"
                alt="faqs"
              />
            </div>
            <span class="title">FAQs</span>
          </a>
          <a href="#request-form">
            <div class="nav-list">
              <img
                src="./images/message-box-d026fb49c2f49d0bae1755f997af409d.svg"
                alt="Message Box"
              />
            </div>
            <span class="title">Submitted Request Form</span>
          </a>
        </nav>
      </div>
      <section>
        <h1>Hi ADMIN</h1>
        <div class="main-bar">
          <div class="board open" id="teams">
            <div class="board-head">
              <h3>TEAM MEMBER LIST</h3>
              <div class="head-btns">
                <button onclick="toggleAddForm()">ADD</button>
                <button class="red" onclick="toggleRemoveForm()">REMOVE</button>
              </div>
            </div>
            <div class="team-listing">
              <table>
                <tr>
                  <th>S/N</th>
                  <th>Picture</th>
                  <th>Name</th>
                  <th>Post</th>
                  <th>Location</th>
                  <th>LinkedIn Url</th>
                </tr>
                <tbody id="list-team"></tbody>
              </table>
              <div id="none">
                <div class="loading"></div>
                <p>No Member Added Yet</p>
              </div>
            </div>

            <div class="form-board add-team">
              <form action="#" id="add-form">
                <label for="picture">
                  <span id="image">Click here to add Picture</span>
                  <input
                    type="file"
                    id="picture"
                    onchange="loadImage(event)"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <label for="name">Name:<input type="text" id="name" /></label>
                <label for="post">Post:<input type="text" id="post" /></label>
                <label for="location"
                  >Location:<input type="text" id="location"
                /></label>
                <label for="linkedin"
                  >LinkedIn Url:<input type="url" id="linkedin"
                /></label>
                <div class="btn-bottom">
                  <button id="add-member">Add Member</button>
                  <button onclick="toggleAddForm()" class="red">Cancel</button>
                </div>
              </form>
            </div>

            <div class="form-board rem-team">
              <form action="#" id="rem-form">
                <p>
                  Kindly input the name of The Team Member you want to remove.
                </p>
                <span>e.g <b>Alawiye Muriala</b></span>
                <p>NOTE: type it as shown in on the Team Page</p>
                <label for="remove-name"
                  >Name:<input type="text" id="remove-name"
                /></label>

                <div class="btn-bottom">
                  <button id="rem-member">Remove</button>
                  <button onclick="toggleRemoveForm()" class="red">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>
          <div class="board" id="services">
            <h1>SERVICES</h1>
          </div>
          <div class="board" id="faqs">
            <h1>FAQs</h1>
          </div>
          <div class="board" id="request-form">
            <h1>REQUEST/COMPLAINT FORM</h1>
          </div>
        </div>
      </section>
    </main>
  </body>

  <!-- <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js "></script> -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    // Import the functions you need from the SDKs you need
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBM8krsrITMACO0twpCEJLzRoGhVsw-S_g",
      authDomain: "tech-lot.firebaseapp.com",
      databaseURL: "https://tech-lot-default-rtdb.firebaseio.com",
      projectId: "tech-lot",
      storageBucket: "tech-lot.appspot.com",
      messagingSenderId: "572043058764",
      appId: "1:572043058764:web:52b9264ee8d7edf9e4dee9",
      measurementId: "G-KR7P391F1T",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    let teamAPI = "";

    import {
      getDatabase,
      ref as databaseRef,
      set,
      get,
      child,
      update,
      remove,
    } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

    import {
      getStorage,
      ref as storageReff,
      deleteObject,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-storage.js";
    const database = getDatabase();

    // references
    const picture = document.querySelector("#picture");
    const name = document.getElementById("name");
    const post = document.getElementById("post");
    const location = document.getElementById("location");
    const linkedin = document.getElementById("linkedin");

    function addTeamMember() {
      // Create a storage reference
      const storage = getStorage();
      const storageRef = storageReff(
        storage,
        "path/TeamPicture/" + name.value + ".jpg"
      );
      const metadata = {
        contentType: picture.files[0].type,
      };

      // Upload the file to Firebase Storage
      uploadBytes(storageRef, picture.files[0], metadata)
        .then((snapshot) => {
          console.log("File uploaded successfully");

          // Get the download URL
          getDownloadURL(snapshot.ref)
            .then((downloadURL) => {
              console.log("Download URL:", downloadURL);

              set(databaseRef(database, "TeamMember/" + name.value), {
                name: name.value,
                post: post.value,
                location: location.value,
                linkedin_url: linkedin.value,
                image_url: downloadURL,
              })
                .then(() => {
                  alert("team Created Successfully");
                  toggleAddForm();
                  document.querySelector("#add-form").reset();
                  getTeamMember();
                })
                .catch((err) => {
                  alert("unsuccessful, error" + err);
                });
            })
            .catch((error) => {
              console.error("Error getting download URL:", error);
            });
        })
        .catch((error) => {
          console.error("Error uploading file:", error);
        });
      // set(ref(database, "tea"));
    }

    // assign event to submit btb
    document
      .getElementById("add-member")
      .addEventListener("click", addTeamMember);
    // ======================= Endss of Adding Team ==============================//

    // ======= asign remove to btn
    document.querySelector("#rem-member").addEventListener("click", () => {
      let isConfirm = confirm("Are you sure you want to delete");
      if (isConfirm) {
        remTeamMember();
      }
    });

    // ====== display Team after calling =======
    function fetchDemoTeamData() {
      teamAPI.forEach((tm, index) => {
        teamBoard.innerHTML += `
                    <tr>
                      <td>${index + 1}.</td>
                      <td><img src="${tm.image_url}" alt="Picture" /></td>
                      <td>${tm.name}</td>
                      <td>${tm.post}</td>
                      <td>${tm.location}</td>
                      <td>${tm.linkedin_url}</td>
                    </tr>
      `;
      });
      setTimeout(() => {
        document.getElementById("none").style.display = "none";
      }, 2000);
    }
    // ========================= Begining of getting Team Members ================================ //

    function getTeamMember() {
      const teamBoard = document.getElementById("list-team");
      const database = getDatabase();
      const dataRef = databaseRef(database, "TeamMember/");

      get(dataRef)
        .then((snapshot) => {
          if (snapshot.exists()) {
            let teamAPIs = snapshot.val();
            teamBoard.innerHTML = "";
            teamAPI = [];
            for (let teamMember in teamAPIs) {
              console.log(teamMember);
              let tm = teamAPIs[teamMember];
              console.log(teamAPIs[teamMember].name);
              teamAPI.push(tm);
            }
            fetchDemoTeamData();
          } else {
            console.log("No data available");
          }
        })
        .catch((error) => {
          console.error(error);
        });
    }
    getTeamMember();

    // ========== deleting from database ============

    function remTeamMember() {
      // Get a reference to the database
      const database = getDatabase();

      // Define the member key to be deleted
      const memberId = document.querySelector("#remove-name").value;

      // alert(memberId);
      // Create a reference to the member node to be deleted
      const memberRef = databaseRef(database, `TeamMember/` + memberId);

      // Remove the member from the database
      remove(memberRef)
        .then(() => {
          alert("Member deleted successfully!");
          getTeamMember();
          toggleRemoveForm();
          deocument.querySelector("#rem-form").reset();
        })
        .catch((error) => {
          alert("Error deleting member:", error);
        });
    }
  </script>
</html>

<script src="./file.js"></script>
