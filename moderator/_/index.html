<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Control Board</title>
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body>
    <main>
      <div class="side-bar">
        <a href="#" class="top-logo">
          <img src="./images/table-icon.svg" alt="dashboard" />
        </a>

        <nav>
          <div href="#teams">
            <div class="nav-list">
              <img
                src="./images/users-643ddc64cb0f826743e01e79f4ccf6ae.svg"
                alt="users"
              />
            </div>
            <span class="title">Teams List</span>
          </div>
          <div href="#services">
            <div class="nav-list">
              <img
                src="./images/incandescent-light-bulb-svgrepo-com.svg
              "
                alt="services"
              />
            </div>
            <span class="title">Service List</span>
          </div>
          <div href="#faqs">
            <div class="nav-list">
              <img
                src="./images/question-mark-inside-square-svgrepo-com.svg"
                alt="faqs"
              />
            </div>
            <span class="title">FAQs</span>
          </div>
          <div href="#request-form">
            <div class="nav-list">
              <img
                src="./images/message-box-d026fb49c2f49d0bae1755f997af409d.svg"
                alt="Message Box"
              />
            </div>
            <span class="title">Submitted Request Form</span>
          </div>
        </nav>
      </div>
      <section>
        <h1>Hi ADMIN</h1>
        <div class="main-bar">
          <div class="board open" id="teams">
            <div class="board-head">
              <h3>TEAM MEMBER LIST</h3>
              <div class="head-btns">
                <button onclick="toggleAddForm()">ADD</button>
                <button class="red" onclick="toggleRemoveForm()">REMOVE</button>
              </div>
            </div>
            <div class="team-listing">
              <table>
                <tr>
                  <th>S/N</th>
                  <th>Picture</th>
                  <th>Name</th>
                  <th>Post</th>
                  <th>Location</th>
                  <th>LinkedIn Url</th>
                </tr>
                <tbody id="list-team"></tbody>
              </table>
              <div id="none">
                <div class="loading"></div>
                <p>No Member Added Yet</p>
              </div>
            </div>

            <div class="form-board add-team">
              <form action="#" id="add-form">
                <label for="picture">
                  <span id="image">Click here to add Picture</span>
                  <input
                    type="file"
                    id="picture"
                    onchange="loadImage(event)"
                    accept="image/*"
                    style="display: none"
                  />
                </label>
                <label for="name">Name:<input type="text" id="name" /></label>
                <label for="post">Post:<input type="text" id="post" /></label>
                <label for="location"
                  >Location:<input type="text" id="location"
                /></label>
                <label for="linkedin"
                  >LinkedIn Url:<input type="url" id="linkedin"
                /></label>
                <div class="btn-bottom">
                  <button id="add-member">Add Member</button>
                  <button onclick="toggleAddForm()" class="red">Cancel</button>
                </div>
              </form>
            </div>

            <div class="form-board rem-team">
              <form action="#" id="rem-form">
                <p>
                  Kindly input the name of The Team Member you want to remove.
                </p>
                <span>e.g <b>Alawiye Muriala</b></span>
                <p>NOTE: type it as shown in on the Team Page</p>
                <label for="remove-name"
                  >Name:<input type="text" id="remove-name"
                /></label>

                <div class="btn-bottom">
                  <button id="rem-member">Remove</button>
                  <button onclick="toggleRemoveForm()" class="red">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>

          <div class="board" id="services">
            <h1>SERVICES</h1>
          </div>

          <div class="board" id="faqs">
            <div class="board-head">
              <h3>LIST of FAQs</h3>
              <div class="head-btns">
                <button onclick="toggleFaqAddForm()">ADD</button>
                <button class="red" onclick="toggleFaqRemoveForm()">
                  REMOVE
                </button>
              </div>
            </div>

            <div class="team-listing">
              <ul class="faqs"></ul>
            </div>

            <div class="form-board add-faq">
              <form action="#" id="add-faq-form">
                <label for="faq-question"
                  >Question:<input type="text" id="faq-question"
                /></label>
                <label id="faq-ans" for="faq-answer">
                  Answer:
                  <textarea id="faq-answer" cols="30" rows="10"></textarea>
                </label>
                <div class="btn-bottom">
                  <button id="add-question">Add Question</button>
                  <button onclick="toggleFaqAddForm()" class="red">
                    Cancel
                  </button>
                </div>
              </form>
            </div>

            <div class="form-board rem-faq">
              <form action="#" id="rem-faq-form">
                <p>Kindly input the qeustion you want to remove.</p>
                <span>e.g <b>How Are You?</b></span>
                <p>NOTE: type it as shown in on the Faq Page</p>
                <label for="remove-question"
                  >Question:<input type="text" id="remove-question"
                /></label>

                <div class="btn-bottom">
                  <button id="rem-question">Remove</button>
                  <button onclick="toggleFaqRemoveForm()" class="red">
                    Cancel
                  </button>
                </div>
              </form>
            </div>
          </div>

          <div class="board" id="request-form">
            <div class="board-head">
              <h3>REQUEST/COMPLAINT FORM</h3>
            </div>

            <div class="team-listing">
              <ul class="randc-form-list">
                <li>
                  <div class="randc-head">
                    <span class="cust-name">Alawiye Muritala</span>
                    <span class="cust-company"
                      ><b><i>Emperor Designs</i></b></span
                    >
                    <div class="randc-contact">
                      <a href="tel:23490590824617" title="Call Alawiye Muritala"
                        >Call</a
                      >
                      <a
                        href="mailto:naijabayz@gmail.com"
                        title="Send mail to Alawiye Muritala"
                        >Send Mail</a
                      >
                    </div>
                  </div>
                  <div class="hidden-info">
                    <span class="randc-tag"
                      >Form for: <b>Embedded Expertise</b></span
                    >
                    <span class="rand-id"
                      >Form ID: <b>20EoXusj92jD2830ES87</b></span
                    >
                  </div>
                  <div class="randc-message">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Consequuntur facere temporibus iste vero illum quaerat
                    molestias sequi, vitae, sed vel dignissimos, eum ratione
                    maiores quos provident maxime accusantium officia inventore.
                  </div>
                </li>
                <li>
                  <div class="randc-head">
                    <span class="cust-name">Alawiye Muritala</span>
                    <span class="cust-company"
                      ><b><i>Emperor Designs</i></b></span
                    >
                    <div class="randc-contact">
                      <a href="tel:23490590824617" title="Call Alawiye Muritala"
                        >Call</a
                      >
                      <a
                        href="mailto:naijabayz@gmail.com"
                        title="Send mail to Alawiye Muritala"
                        >Send Mail</a
                      >
                    </div>
                  </div>
                  <div class="hidden-info">
                    <span class="randc-tag"
                      >Form for: <b>Embedded Expertise</b></span
                    >
                    <span class="rand-id"
                      >Form ID: <b>20EoXusj92jD2830ES87</b></span
                    >
                  </div>
                  <div class="randc-message">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Consequuntur facere temporibus iste vero illum quaerat
                    molestias sequi, vitae, sed vel dignissimos, eum ratione
                    maiores quos provident maxime accusantium officia inventore.
                  </div>
                </li>
                <li>
                  <div class="randc-head">
                    <span class="cust-name">Alawiye Muritala</span>
                    <span class="cust-company"
                      ><b><i>Emperor Designs</i></b></span
                    >
                    <div class="randc-contact">
                      <a href="tel:23490590824617" title="Call Alawiye Muritala"
                        >Call</a
                      >
                      <a
                        href="mailto:naijabayz@gmail.com"
                        title="Send mail to Alawiye Muritala"
                        >Send Mail</a
                      >
                    </div>
                  </div>
                  <div class="hidden-info">
                    <span class="randc-tag"
                      >Form for: <b>Embedded Expertise</b></span
                    >
                    <span class="randc-id"
                      >Form ID: <b>20EoXusj92jD2830ES87</b></span
                    >
                  </div>
                  <div class="randc-message">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit.
                    Consequuntur facere temporibus iste vero illum quaerat
                    molestias sequi, vitae, sed vel dignissimos, eum ratione
                    maiores quos provident maxime accusantium officia inventore.
                  </div>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </section>
    </main>
  </body>

  <!-- <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js "></script> -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-app.js";
    // Import the functions you need from the SDKs you need
    // TODO: Add SDKs for Firebase products that you want to use
    // https://firebase.google.com/docs/web/setup#available-libraries

    // Your web app's Firebase configuration
    // For Firebase JS SDK v7.20.0 and later, measurementId is optional
    const firebaseConfig = {
      apiKey: "AIzaSyBM8krsrITMACO0twpCEJLzRoGhVsw-S_g",
      authDomain: "tech-lot.firebaseapp.com",
      databaseURL: "https://tech-lot-default-rtdb.firebaseio.com",
      projectId: "tech-lot",
      storageBucket: "tech-lot.appspot.com",
      messagingSenderId: "572043058764",
      appId: "1:572043058764:web:52b9264ee8d7edf9e4dee9",
      measurementId: "G-KR7P391F1T",
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    let teamAPI = "";
    let faqAPI = "";
    let requestAPI = "";

    import {
      getDatabase,
      ref as databaseRef,
      set,
      get,
      child,
      update,
      remove,
    } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-database.js";

    import {
      getStorage,
      ref as storageReff,
      deleteObject,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.19.1/firebase-storage.js";
    const database = getDatabase();

    // ======================== add team member function ===============================

    function addTeamMember() {
      // references
      const picture = document.querySelector("#picture");
      const name = document.getElementById("name");
      const post = document.getElementById("post");
      const location = document.getElementById("location");
      const linkedin = document.getElementById("linkedin");

      // Create a storage reference
      const storage = getStorage();
      const storageRef = storageReff(
        storage,
        "path/TeamPicture/" + name.value + ".jpg"
      );
      const metadata = {
        contentType: picture.files[0].type,
      };

      // Upload the file to Firebase Storage
      uploadBytes(storageRef, picture.files[0], metadata)
        .then((snapshot) => {
          console.log("File uploaded successfully");

          // Get the download URL
          getDownloadURL(snapshot.ref)
            .then((downloadURL) => {
              console.log("Download URL:", downloadURL);

              set(databaseRef(database, "TeamMember/" + name.value), {
                name: name.value,
                post: post.value,
                location: location.value,
                linkedin_url: linkedin.value,
                image_url: downloadURL,
              })
                .then(() => {
                  alert("team Created Successfully");
                  toggleAddForm();
                  document.querySelector("#add-form").reset();
                  getTeamMember();
                })
                .catch((err) => {
                  alert("unsuccessful, error" + err);
                });
            })
            .catch((error) => {
              console.error("Error getting download URL:", error);
            });
        })
        .catch((error) => {
          console.error("Error uploading file:", error);
        });
      // set(ref(database, "tea"));
    }

    // assign event to submit btb
    document
      .getElementById("add-member")
      .addEventListener("click", addTeamMember);
    // ======================= Endss of Adding Team ==============================//

    // ======= asign remove to btn ========================
    document.querySelector("#rem-member").addEventListener("click", () => {
      let isConfirm = confirm("Are you sure you want to delete?");
      if (isConfirm) {
        remTeamMember();
      }
    });

    // ======================== add team member function ===============================

    function addFaqQuestion() {
      alert("add faq btn clicked");
      // references
      const question = document.getElementById("faq-question");
      const answer = document.getElementById("faq-answer");

      set(databaseRef(database, "FaqQuestion/" + question.value), {
        question: question.value,
        answer: answer.value,
      })
        .then(() => {
          alert("Faq added Successfully");
          toggleFaqAddForm();
          document.querySelector("#add-faq-form").reset();
          getFaqQuestion();
        })
        .catch((err) => {
          alert("unsuccessful, error" + err);
        });
    }

    // assign event to submit btb
    document
      .getElementById("add-question")
      .addEventListener("click", addFaqQuestion);
    // ======================= Endss of Adding Team ==============================//

    // ======= asign remove to btn
    document.querySelector("#rem-question").addEventListener("click", () => {
      let isConfirm = confirm("Are you sure you want to delete");
      if (isConfirm) {
        remFaqQuestion();
      }
    });

    // ====== display Team after calling =======
    function fetchDemoTeamData() {
      teamAPI.forEach((tm, index) => {
        teamBoard.innerHTML += `
                    <tr>
                      <td>${index + 1}.</td>
                      <td><img src="${tm.image_url}" alt="Picture" /></td>
                      <td>${tm.name}</td>
                      <td>${tm.post}</td>
                      <td>${tm.location}</td>
                      <td>${tm.linkedin_url}</td>
                    </tr>
      `;
      });
      setTimeout(() => {
        document.getElementById("none").style.display = "none";
      }, 2000);
    }

    // ====== display Faq after calling =======
    function fetchDemoFaq() {
      const faqBoard = document.querySelector(".faqs");
      faqAPI.forEach((tm, index) => {
        faqBoard.innerHTML += `
                <li class="faq">
                  <h3>${tm.question}</h3>
                  <p>
                    <b>Answer:</b> ${tm.answer}
                  </p>
                </li>
      `;
      });
    }

    // ====== display request after calling =======
    function fetchDemoRequest() {
      const requestBoard = document.querySelector(".randc-form-list");
      requestAPI.forEach((tm, index) => {
        requestBoard.innerHTML += `
                <li>
                  <div class="randc-head">
                    <span class="cust-name">${tm.customerName}</span>
                    <span class="cust-company"
                      ><b><i>${tm.customerCompanyName}</i></b></span
                    >
                    <div class="randc-contact">
                      <a href="tel:${tm.customerPhoneNumber}" title="Call ${tm.customerName}"
                        >Call</a
                      >
                      <a
                        href="mailto:${tm.customerEmail}"
                        title="Send mail to ${tm.customerName}"
                        >Send Mail</a
                      >
                    </div>
                  </div>
                  <div class="hidden-info">
                    <span class="randc-tag"
                      >Form for: <b>${tm.requestService}</b></span
                    >
                    <span class="randc-id"
                      >Form ID: <b>${tm.id}</b></span
                    >
                  </div>
                  <div class="randc-message">
                    ${tm.customerMessage}
                  </div>
                </li>
      `;
      });
    }

    // ========================= Begining of getting Team Members ================================ //

    function getTeamMember() {
      const teamBoard = document.getElementById("list-team");
      const database = getDatabase();
      const dataRef = databaseRef(database, "TeamMember/");

      get(dataRef)
        .then((snapshot) => {
          if (snapshot.exists()) {
            let teamAPIs = snapshot.val();
            teamBoard.innerHTML = "";
            teamAPI = [];
            for (let teamMember in teamAPIs) {
              // console.log(teamMember);
              let tm = teamAPIs[teamMember];
              // console.log(teamAPIs[teamMember].name);
              teamAPI.push(tm);
            }
            fetchDemoTeamData();
          } else {
            console.log("No data available");
          }
        })
        .catch((error) => {
          console.error(error);
        });
    }
    getTeamMember();

    // ========================= Begining of getting FAQs from database ================================ //

    function getFaqQuestion() {
      const faqBoard = document.querySelector(".faqs");
      const database = getDatabase();
      const dataRef = databaseRef(database, "FaqQuestion/");

      get(dataRef)
        .then((snapshot) => {
          if (snapshot.exists()) {
            let faqAPIs = snapshot.val();
            faqBoard.innerHTML = "";
            faqAPI = [];
            for (let faqQuestion in faqAPIs) {
              // console.log(faqQuestion);
              let tm = faqAPIs[faqQuestion];
              faqAPI.push(tm);
            }
            fetchDemoFaq();
          } else {
            alert("No Faq available");
          }
        })
        .catch((error) => {
          console.error(error);
        });
    }
    getFaqQuestion();

    // ========================= Begining of getting request form from database ================================ //

    function getRequestForm() {
      const requestBoard = document.querySelector(".randc-form-list");
      const database = getDatabase();
      const dataRef = databaseRef(database, "RequestForm/");

      get(dataRef)
        .then((snapshot) => {
          if (snapshot.exists()) {
            let requestAPIs = snapshot.val();
            requestBoard.innerHTML = "";
            requestAPI = [];
            for (let request in requestAPIs) {
              // console.log(request);
              let tm = requestAPIs[request];
              requestAPI.push(tm);
            }
            fetchDemoRequest();
          } else {
            alert("No request form available");
          }
        })
        .catch((error) => {
          console.error(error);
        });
    }
    getRequestForm();

    // ========== deleting from database ============remFaqQuestion

    function remTeamMember() {
      // Get a reference to the database
      const database = getDatabase();

      // Define the member key to be deleted
      const memberId = document.querySelector("#remove-name").value;

      // alert(memberId);
      // Create a reference to the member node to be deleted
      const memberRef = databaseRef(database, `TeamMember/` + memberId);

      // Remove the member from the database
      remove(memberRef)
        .then(() => {
          alert("Member deleted successfully!");
          getTeamMember();
          toggleRemoveForm();
          deocument.querySelector("#rem-form").reset();
        })
        .catch((error) => {
          alert("Error deleting member:", error);
        });
    }

    // ========== deleting FAQ ============

    function remFaqQuestion() {
      // Get a reference to the database
      const database = getDatabase();

      // Define the member key to be deleted
      const memberId = document.querySelector("#remove-question").value;

      // alert(memberId);
      // Create a reference to the member node to be deleted
      const memberRef = databaseRef(database, `FaqQuestion/` + memberId);

      // Remove the member from the database
      remove(memberRef)
        .then(() => {
          alert("Question deteled successfully!");
          getFaqQuestion();
          toggleFaqRemoveForm();
          deocument.querySelector("#rem-faq-form").reset();
        })
        .catch((error) => {
          alert("Error deleting Faq:", error);
        });
    }
  </script>
</html>

<script src="./file.js"></script>
